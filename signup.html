<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'mango': '#FF8C42',
                        'navy': '#1B2951',
                        'charcoal': '#2D3748'
                    },
                    fontFamily: {
                        'heading': ['Inter', 'sans-serif'],
                        'body': ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <!-- Removed external Google Fonts to avoid net::ERR_ABORTED in preview env -->
    <script> window.FontAwesomeConfig = { autoReplaceSvg: 'nest'};</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>::-webkit-scrollbar { display: none;}</style>
</head>
<body class="font-body bg-gray-50">
    
    <div id="main-container" class="min-h-screen flex items-center justify-center py-12 px-4">
        <div id="signup-card" class="w-full max-w-4xl bg-white rounded-2xl shadow-xl p-8">
            
            <!-- Header Section -->
            <div id="header-section" class="text-center mb-8">
                <h1 class="text-3xl font-heading font-bold text-navy mb-3">Sign up</h1>
                <p class="text-gray-600 text-sm">Both individual and corporate members must enter the responsible person's personal information</p>
            </div>

            <!-- Role Selector -->
            <div id="role-selector" class="flex justify-center mb-8">
                <div class="inline-flex bg-gray-100 rounded-lg p-1">
                    <button id="buyer-tab" class="px-8 py-2 rounded-md bg-white text-navy font-medium shadow-sm transition-all">
                        Buyer
                    </button>
                    <button id="seller-tab" class="px-8 py-2 rounded-md text-gray-500 font-medium transition-all hover:text-navy">
                        Seller
                    </button>
                </div>
            </div>

            <!-- Buyer Form -->
            <div id="buyer-form" class="space-y-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Left Column -->
                    <div class="space-y-6">
                        <!-- Name Field -->
                        <div>
                            <label class="block text-sm font-medium text-charcoal mb-2">
                                Name <span class="text-gray-400 text-xs">(only Korean and English)</span>
                            </label>
                            <input type="text" placeholder="Please enter your name" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                        </div>

                        <!-- Password Field -->
                        <div>
                            <label class="block text-sm font-medium text-charcoal mb-2">Password</label>
                            <div class="relative">
                                <input type="password" placeholder="Please enter your password" 
                                       class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                                <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-4">
                                    <i class="fa-regular fa-eye text-gray-400 hover:text-gray-600"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Confirm Password Field -->
                        <div>
                            <label class="block text-sm font-medium text-charcoal mb-2">Confirm Password</label>
                            <div class="relative">
                                <input type="password" placeholder="Please enter your password" 
                                       class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                                <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-4">
                                    <i class="fa-regular fa-eye text-gray-400 hover:text-gray-600"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="space-y-6">
                        <!-- Email Field -->
                        <div>
                            <label class="block text-sm font-medium text-charcoal mb-2">Email</label>
                            <input type="email" placeholder="Please enter your email address" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                        </div>

                        <!-- Country Field -->
                        <div>
                            <label class="block text-sm font-medium text-charcoal mb-2">Select Country</label>
                            <div class="relative">
                                <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all appearance-none bg-white">
                                    <option>Please select the country</option>
                                    <option>United States</option>
                                    <option>South Korea</option>
                                    <option>Canada</option>
                                    <option>United Kingdom</option>
                                </select>
                                <i class="fa-solid fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>

                        <!-- Mobile Phone Field -->
                        <div>
                            <label class="block text-sm font-medium text-charcoal mb-2">Mobile Phone Number</label>
                            <input type="tel" placeholder="Enter only numbers excluding '-'" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                        </div>
                    </div>
                </div>

                <!-- Agreements Section -->
                <div id="agreements-section" class="space-y-4 pt-6 border-t border-gray-200">
                    <div class="flex items-start space-x-3">
                        <input type="checkbox" id="terms-required" class="mt-1 h-4 w-4 text-mango focus:ring-mango border-gray-300 rounded">
                        <label for="terms-required" class="text-sm text-charcoal">
                            I agree to the <span class="text-mango underline hover:text-orange-600 cursor-pointer">nsm autos card Terms of Use</span> and 
                            <span class="text-mango underline hover:text-orange-600 cursor-pointer">Privacy Policy</span>. 
                            <span class="text-red-500 font-medium">(Required)</span>
                        </label>
                    </div>

                    <div class="flex items-start space-x-3">
                        <input type="checkbox" id="marketing-optional" class="mt-1 h-4 w-4 text-mango focus:ring-mango border-gray-300 rounded">
                        <label for="marketing-optional" class="text-sm text-charcoal">
                            I agree to the <span class="text-mango underline hover:text-orange-600 cursor-pointer">Marketing Use Policy</span>. 
                            <span class="text-gray-500">(Optional)</span>
                        </label>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div id="action-buttons" class="flex justify-between items-center pt-8">
                    <button type="button" class="px-8 py-3 border-2 border-gray-300 text-gray-600 font-medium rounded-lg hover:bg-gray-50 transition-all">
                        Previous
                    </button>
                    <button type="submit" class="px-8 py-3 bg-navy text-white font-medium rounded-lg hover:bg-blue-900 transition-all">
                        Submit
                    </button>
                </div>
            </div>

            <!-- Seller Form (Hidden by default) -->
            <div id="seller-form" class="hidden space-y-8">
                <!-- Personal Information Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Left Column - Personal Info -->
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-charcoal mb-2">Name</label>
                            <input type="text" placeholder="Please enter your name" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-charcoal mb-2">Password</label>
                            <div class="relative">
                                <input type="password" placeholder="Please enter your password" 
                                       class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                                <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-4">
                                    <i class="fa-regular fa-eye text-gray-400 hover:text-gray-600"></i>
                                </button>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-charcoal mb-2">Confirm Password</label>
                            <div class="relative">
                                <input type="password" placeholder="Please enter your password" 
                                       class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                                <button type="button" class="absolute inset-y-0 right-0 flex items-center pr-4">
                                    <i class="fa-regular fa-eye text-gray-400 hover:text-gray-600"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column - Personal Info -->
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-charcoal mb-2">Email</label>
                            <input type="email" placeholder="Please enter your email address" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-charcoal mb-2">Select Country</label>
                            <div class="relative">
                                <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all appearance-none bg-white">
                                    <option>Please select the country</option>
                                    <option>United States</option>
                                    <option>South Korea</option>
                                    <option>Canada</option>
                                </select>
                                <i class="fa-solid fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-charcoal mb-2">Mobile Phone Number</label>
                            <input type="tel" placeholder="Enter only numbers excluding '-'" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                        </div>
                    </div>
                </div>

                <!-- Company Information Section -->
                <div class="border-t border-gray-200 pt-8">
                    <h3 class="text-lg font-heading font-semibold text-navy mb-6">Company Information</h3>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Left Column - Company Details -->
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-charcoal mb-2">Company Name (Korean)</label>
                                <input type="text" placeholder="회사명을 입력하세요" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-charcoal mb-2">Company Name (English)</label>
                                <input type="text" placeholder="Enter company name" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-charcoal mb-2">Representative Name</label>
                                <input type="text" placeholder="Enter representative name" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-charcoal mb-2">Company Tel</label>
                                <input type="tel" placeholder="Enter company phone number" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-charcoal mb-2">Company Address</label>
                                <div class="flex space-x-2">
                                    <input type="text" placeholder="Enter company address" 
                                           class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                                    <button type="button" class="px-4 py-3 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-all">
                                        Search
                                    </button>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-charcoal mb-2">Detailed Address</label>
                                <input type="text" placeholder="Enter detailed address" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-charcoal mb-2">Business Registration</label>
                                <div class="flex items-center space-x-2">
                                    <input type="file" id="business-reg" class="hidden">
                                    <label for="business-reg" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-all">
                                        <span id="business-reg-label-text" class="text-gray-500">Choose file</span>
                                    </label>
                                    <button id="business-reg-select-btn" type="button" class="px-4 py-3 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-all">
                                        File Select
                                    </button>
                                </div>
                            </div>

                            <!-- Account Information -->
                            <div class="pt-4">
                                <h4 class="text-base font-medium text-charcoal mb-4">Account Information</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-charcoal mb-2">Bank Name</label>
                                        <input type="text" placeholder="Enter bank name" 
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-charcoal mb-2">Account Number</label>
                                        <input type="text" placeholder="Enter account number" 
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-charcoal mb-2">Account Holder Name</label>
                                        <input type="text" placeholder="Enter account holder name" 
                                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column - Additional Details -->
                        <div class="space-y-6">
                            <!-- Export Items -->
                            <div>
                                <label class="block text-sm font-medium text-charcoal mb-3">Export Items</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="radio" name="export-items" value="car" class="h-4 w-4 text-mango focus:ring-mango border-gray-300">
                                        <span class="ml-2 text-sm text-charcoal">Car</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="export-items" value="bus" class="h-4 w-4 text-mango focus:ring-mango border-gray-300">
                                        <span class="ml-2 text-sm text-charcoal">Bus</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="export-items" value="truck" class="h-4 w-4 text-mango focus:ring-mango border-gray-300">
                                        <span class="ml-2 text-sm text-charcoal">Truck</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Available Languages -->
                            <div>
                                <label class="block text-sm font-medium text-charcoal mb-3">Available Languages</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" class="h-4 w-4 text-mango focus:ring-mango border-gray-300 rounded">
                                        <span class="ml-2 text-sm text-charcoal">English</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="h-4 w-4 text-mango focus:ring-mango border-gray-300 rounded">
                                        <span class="ml-2 text-sm text-charcoal">Spanish</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="h-4 w-4 text-mango focus:ring-mango border-gray-300 rounded">
                                        <span class="ml-2 text-sm text-charcoal">Korean</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="h-4 w-4 text-mango focus:ring-mango border-gray-300 rounded">
                                        <span class="ml-2 text-sm text-charcoal">Azerbaijani</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="h-4 w-4 text-mango focus:ring-mango border-gray-300 rounded">
                                        <span class="ml-2 text-sm text-charcoal">Arabic</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="h-4 w-4 text-mango focus:ring-mango border-gray-300 rounded">
                                        <span class="ml-2 text-sm text-charcoal">Russian</span>
                                    </label>
                                    <label class="flex items-center col-span-2">
                                        <input type="checkbox" class="h-4 w-4 text-mango focus:ring-mango border-gray-300 rounded">
                                        <span class="ml-2 text-sm text-charcoal">Other</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Company Logo -->
                            <div>
                                <label class="block text-sm font-medium text-charcoal mb-3">Company Logo</label>
                                <div class="flex flex-col items-center">
                                    <div class="w-24 h-24 rounded-full bg-gray-100 border-2 border-dashed border-gray-300 flex items-center justify-center mb-3">
                                        <i class="fa-solid fa-camera text-gray-400 text-xl"></i>
                                    </div>
                                    <input type="file" id="company-logo" class="hidden">
                                    <label id="company-logo-select-label" for="company-logo" class="px-4 py-2 bg-gray-100 text-gray-600 rounded-lg cursor-pointer hover:bg-gray-200 transition-all text-sm">
                                        File Select
                                    </label>
                                    <p class="text-xs text-gray-500 mt-2">Upload your company logo</p>
                                </div>
                            </div>

                            <!-- Establishment Date -->
                            <div>
                                <label class="block text-sm font-medium text-charcoal mb-2">Establishment Date</label>
                                <input type="date" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all">
                            </div>

                            <!-- Company Introduction -->
                            <div>
                                <label class="block text-sm font-medium text-charcoal mb-2">Company Introduction</label>
                                <textarea rows="6" placeholder="Tell us about your company..." 
                                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-mango focus:border-transparent transition-all resize-none"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Seller Agreements Section -->
                <div class="space-y-4 pt-6 border-t border-gray-200">
                    <div class="flex items-start space-x-3">
                        <input type="checkbox" id="seller-terms-required" class="mt-1 h-4 w-4 text-mango focus:ring-mango border-gray-300 rounded">
                        <label for="seller-terms-required" class="text-sm text-charcoal">
                            I agree to the <span class="text-mango underline hover:text-orange-600 cursor-pointer">nsm autos card Terms of Use</span> and 
                            <span class="text-mango underline hover:text-orange-600 cursor-pointer">Privacy Policy</span>. 
                            <span class="text-red-500 font-medium">(Required)</span>
                        </label>
                    </div>

                    <div class="flex items-start space-x-3">
                        <input type="checkbox" id="seller-marketing-optional" class="mt-1 h-4 w-4 text-mango focus:ring-mango border-gray-300 rounded">
                        <label for="seller-marketing-optional" class="text-sm text-charcoal">
                            I agree to the <span class="text-mango underline hover:text-orange-600 cursor-pointer">Marketing Use Policy</span>. 
                            <span class="text-gray-500">(Optional)</span>
                        </label>
                    </div>
                </div>

                <!-- Seller Action Buttons -->
                <div class="flex justify-between items-center pt-8">
                    <button type="button" class="px-8 py-3 border-2 border-gray-300 text-gray-600 font-medium rounded-lg hover:bg-gray-50 transition-all">
                        Previous
                    </button>
                    <button type="submit" class="px-8 py-3 bg-navy text-white font-medium rounded-lg hover:bg-blue-900 transition-all">
                        Submit
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        const buyerTab = document.getElementById('buyer-tab');
        const sellerTab = document.getElementById('seller-tab');
        const buyerForm = document.getElementById('buyer-form');
        const sellerForm = document.getElementById('seller-form');

        buyerTab.addEventListener('click', function() {
            buyerTab.classList.add('bg-white', 'text-navy', 'shadow-sm');
            buyerTab.classList.remove('text-gray-500');
            sellerTab.classList.remove('bg-white', 'text-navy', 'shadow-sm');
            sellerTab.classList.add('text-gray-500');
            
            buyerForm.classList.remove('hidden');
            sellerForm.classList.add('hidden');
        });

        sellerTab.addEventListener('click', function() {
            sellerTab.classList.add('bg-white', 'text-navy', 'shadow-sm');
            sellerTab.classList.remove('text-gray-500');
            buyerTab.classList.remove('bg-white', 'text-navy', 'shadow-sm');
            buyerTab.classList.add('text-gray-500');
            
            sellerForm.classList.remove('hidden');
            buyerForm.classList.add('hidden');
        });

        // Password visibility toggle
        document.querySelectorAll('button[type="button"]').forEach(button => {
            if (button.querySelector('.fa-eye')) {
                button.addEventListener('click', function() {
                    const input = this.previousElementSibling;
                    const icon = this.querySelector('i');
                    
                    if (input.type === 'password') {
                        input.type = 'text';
                        icon.classList.remove('fa-eye');
                        icon.classList.add('fa-eye-slash');
                    } else {
                        input.type = 'password';
                        icon.classList.remove('fa-eye-slash');
                        icon.classList.add('fa-eye');
                    }
                });
            }
        });

        // Seller file upload wiring (top Tailwind forms)
        const businessRegInput = document.getElementById('business-reg');
        const businessRegBtn = document.getElementById('business-reg-select-btn');
        const businessRegLabelText = document.getElementById('business-reg-label-text');
        const companyLogoInput = document.getElementById('company-logo');
        const companyLogoLabel = document.getElementById('company-logo-select-label');

        function showTempStatus(el, text){
            if(!el) return;
            const prev = el.textContent;
            el.textContent = text;
            setTimeout(()=>{ el.textContent = prev; }, 2000);
        }

        async function fileToDataUrl(file){
            return new Promise(function(resolve, reject){
                try {
                    const reader = new FileReader();
                    reader.onload = function(){ resolve(reader.result); };
                    reader.onerror = function(e){ reject(e); };
                    reader.readAsDataURL(file);
                } catch (e) { reject(e); }
            });
        }
        async function uploadFileToServer(file){
            const dataUrl = await fileToDataUrl(file);
            const resp = await fetch('http://localhost:3000/upload', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                body: JSON.stringify({ filename: file.name, dataUrl })
            });
            let out = null;
            try { out = await resp.json(); } catch(_) {}
            if (!resp.ok || !out || !out.url) {
                const errMsg = (out && out.error) ? out.error : ('Upload failed (HTTP '+resp.status+')');
                throw new Error(errMsg);
            }
            return 'http://localhost:3000' + out.url;
        }

        if (businessRegBtn && businessRegInput) {
            businessRegBtn.addEventListener('click', function(){ businessRegInput.click(); });
        }
        if (businessRegInput) {
            businessRegInput.addEventListener('change', async function(){
                const file = this.files && this.files[0];
                if (!file) return;
                if (businessRegLabelText) businessRegLabelText.textContent = file.name;
                try {
                    const url = await uploadFileToServer(file);
                    businessRegInput.dataset.uploadedUrl = url;
                    showTempStatus(businessRegLabelText, 'Uploaded');
                } catch (err) {
                    console.error('Business registration upload error:', err);
                    alert('Business registration upload failed: ' + err.message);
                    delete businessRegInput.dataset.uploadedUrl;
                }
            });
        }
        if (companyLogoInput) {
            companyLogoInput.addEventListener('change', async function(){
                const file = this.files && this.files[0];
                if (!file) return;
                if (companyLogoLabel) companyLogoLabel.textContent = file.name;
                try {
                    const url = await uploadFileToServer(file);
                    companyLogoInput.dataset.uploadedUrl = url;
                    showTempStatus(companyLogoLabel, 'Uploaded');
                } catch (err) {
                    console.error('Company logo upload error:', err);
                    alert('Company logo upload failed: ' + err.message);
                    delete companyLogoInput.dataset.uploadedUrl;
                }
            });
        }
    </script>

</body>
</html>

<script>
// Signup API wiring
(function(){
  const buyerForm = document.getElementById('buyer-form');
  const sellerForm = document.getElementById('seller-form');

  function findInputByLabel(container, startsWithText){
    const labels = container.querySelectorAll('label');
    for(const label of labels){
      const txt = label.textContent.trim();
      if(txt.startsWith(startsWithText)){
        // Try immediate sibling wrapper
        const sib = label.nextElementSibling;
        if(sib){
          const found = sib.querySelector('input,select,textarea');
          if(found) return found;
        }
        // Fallback: search parent
        const parentFound = label.parentElement.querySelector('input,select,textarea');
        if(parentFound) return parentFound;
      }
    }
    return null;
  }

  function getBuyerFields(){
    return {
      name: findInputByLabel(buyerForm,'Name'),
      email: findInputByLabel(buyerForm,'Email'),
      password: findInputByLabel(buyerForm,'Password'),
      confirm: findInputByLabel(buyerForm,'Confirm Password'),
      country: findInputByLabel(buyerForm,'Select Country'),
      phone: findInputByLabel(buyerForm,'Mobile Phone Number')
    };
  }
  function getSellerFields(){
    return {
      name: findInputByLabel(sellerForm,'Name'),
      email: findInputByLabel(sellerForm,'Email'),
      password: findInputByLabel(sellerForm,'Password'),
      confirm: findInputByLabel(sellerForm,'Confirm Password'),
      country: findInputByLabel(sellerForm,'Select Country'),
      phone: findInputByLabel(sellerForm,'Mobile Phone Number'),
      companyNameKr: findInputByLabel(sellerForm,'Company Name (Korean)'),
      companyNameEn: findInputByLabel(sellerForm,'Company Name (English)'),
      representativeName: findInputByLabel(sellerForm,'Representative Name'),
      companyPhone: findInputByLabel(sellerForm,'Company Tel'),
      companyAddress: findInputByLabel(sellerForm,'Company Address'),
      detailedAddress: findInputByLabel(sellerForm,'Detailed Address'),
      establishmentDate: findInputByLabel(sellerForm,'Establishment Date'),
      companyIntro: findInputByLabel(sellerForm,'Company Introduction'),
      bankName: findInputByLabel(sellerForm,'Bank Name'),
      accountNumber: findInputByLabel(sellerForm,'Account Number'),
      accountHolderName: findInputByLabel(sellerForm,'Account Holder Name'),
      businessRegFile: document.getElementById('business-reg'),
      companyLogoFile: document.getElementById('company-logo')
    };
  }

  async function submitSignup(role){
    const isBuyer = role === 'buyer';
    const fields = isBuyer ? getBuyerFields() : getSellerFields();
    if(!fields.name || !fields.email || !fields.password || !fields.confirm){
      alert('Unable to read form fields. Please try again or contact support.');
      return;
    }
    const name = fields.name.value.trim();
    const email = fields.email.value.trim();
    const password = fields.password.value;
    const confirm = fields.confirm.value;

    if(!name || !email || !password){
      alert('Please fill in Name, Email, and Password.');
      return;
    }
    if(password !== confirm){
      alert('Passwords do not match.');
      return;
    }

    // Common required fields per role
    const countryVal = fields.country && fields.country.value && fields.country.value !== 'Please select the country' ? fields.country.value.trim() : '';
    const phoneVal = (fields.phone && fields.phone.value ? fields.phone.value.trim() : '');

    // Terms acceptance (visible checkboxes in Tailwind forms)
    const buyerTerms = document.getElementById('terms-required');
    const sellerTerms = document.getElementById('seller-terms-required');

    const missing = [];
    if (!countryVal) missing.push('Country');
    if (!phoneVal) missing.push('Mobile Phone Number');
    if (isBuyer) {
      if (buyerTerms && !buyerTerms.checked) missing.push('Required Terms agreement');
    }

    // Build payload aligned to backend columns
    const basePayload = {
      name,
      email,
      password,
      role,
      country: countryVal || undefined,
      phone_number: phoneVal || undefined
    };

    let payload = basePayload;
    if (!isBuyer) {
      // Seller-specific payload
      const exportItem = sellerForm.querySelector('input[name="export-items"]:checked');
      const langLabels = Array.from(sellerForm.querySelectorAll('label .ml-2')).map(function(span){ return span.textContent.trim(); });
      const langCheckboxes = Array.from(sellerForm.querySelectorAll('div.grid input[type="checkbox"]'));
      const langs = [];
      langCheckboxes.forEach(function(cb, idx){ if(cb.checked) langs.push(langLabels[idx] || 'Unknown'); });

      async function fileToDataUrl(file){
        return new Promise(function(resolve, reject){
          try {
            var reader = new FileReader();
            reader.onload = function(){ resolve(reader.result); };
            reader.onerror = function(e){ reject(e); };
            reader.readAsDataURL(file);
          } catch (e) { reject(e); }
        });
      }
      async function uploadFileToServer(file){
        var dataUrl = await fileToDataUrl(file);
        var resp = await fetch('http://localhost:3000/upload', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
          body: JSON.stringify({ filename: file.name, dataUrl: dataUrl })
        });
        var out = await resp.json();
        if (!resp.ok || !out || !out.url) throw new Error(out && out.error ? out.error : 'Upload failed');
        return 'http://localhost:3000' + out.url;
      }
      let companyLogoUrl = (fields.companyLogoFile && fields.companyLogoFile.dataset && fields.companyLogoFile.dataset.uploadedUrl) ? fields.companyLogoFile.dataset.uploadedUrl : '';
      if (!companyLogoUrl && fields.companyLogoFile && fields.companyLogoFile.files && fields.companyLogoFile.files[0]) {
        try { companyLogoUrl = await uploadFileToServer(fields.companyLogoFile.files[0]); }
        catch(e) { alert('Company logo upload failed: ' + (e && e.message ? e.message : e)); return; }
      }
      let businessRegUrl = (fields.businessRegFile && fields.businessRegFile.dataset && fields.businessRegFile.dataset.uploadedUrl) ? fields.businessRegFile.dataset.uploadedUrl : '';
      if (!businessRegUrl && fields.businessRegFile && fields.businessRegFile.files && fields.businessRegFile.files[0]) {
        try { businessRegUrl = await uploadFileToServer(fields.businessRegFile.files[0]); }
        catch(e) { alert('Business registration upload failed: ' + (e && e.message ? e.message : e)); return; }
      }

      payload = {
        ...basePayload,
        company_name_korean: (fields.companyNameKr && fields.companyNameKr.value ? fields.companyNameKr.value.trim() : undefined),
        company_name_english: (fields.companyNameEn && fields.companyNameEn.value ? fields.companyNameEn.value.trim() : undefined),
        representative_name: (fields.representativeName && fields.representativeName.value ? fields.representativeName.value.trim() : undefined),
        company_tel: (fields.companyPhone && fields.companyPhone.value ? fields.companyPhone.value.trim() : undefined),
        company_address: (fields.companyAddress && fields.companyAddress.value ? fields.companyAddress.value.trim() : undefined),
        detailed_address: (fields.detailedAddress && fields.detailedAddress.value ? fields.detailedAddress.value.trim() : undefined),
        establishment_date: (fields.establishmentDate && fields.establishmentDate.value ? fields.establishmentDate.value : undefined),
        business_registration_url: businessRegUrl || undefined,
        business_registration_document: businessRegUrl || undefined,
        company_introduction: (fields.companyIntro && fields.companyIntro.value ? fields.companyIntro.value.trim() : undefined),
        bank_name: (fields.bankName && fields.bankName.value ? fields.bankName.value.trim() : undefined),
        account_number: (fields.accountNumber && fields.accountNumber.value ? fields.accountNumber.value.trim() : undefined),
        account_holder_name: (fields.accountHolderName && fields.accountHolderName.value ? fields.accountHolderName.value.trim() : undefined),
        company_logo_url: companyLogoUrl || undefined,
        export_items: (exportItem && exportItem.value ? exportItem.value : undefined),
        available_languages: langs.length ? langs : undefined
      };

      // Seller required fields validation
      if (!payload.company_name_korean) missing.push('Company Name (Korean)');
      if (!payload.company_name_english) missing.push('Company Name (English)');
      if (!payload.representative_name) missing.push('Representative Name');
      if (!payload.company_tel) missing.push('Company Tel');
      if (!payload.company_address) missing.push('Company Address');
      if (!payload.detailed_address) missing.push('Detailed Address');
      if (!payload.establishment_date) missing.push('Establishment Date');
      if (!payload.company_introduction) missing.push('Company Introduction');
      if (!payload.bank_name) missing.push('Bank Name');
      if (!payload.account_number) missing.push('Account Number');
      if (!payload.account_holder_name) missing.push('Account Holder Name');
      if (!payload.export_items) missing.push('Export Items');
      if (!payload.available_languages || (Array.isArray(payload.available_languages) && payload.available_languages.length === 0)) missing.push('Available Languages');
      if (!payload.company_logo_url) missing.push('Company Logo');
      if (!payload.business_registration_url) missing.push('Business Registration');
      if (sellerTerms && !sellerTerms.checked) missing.push('Required Terms agreement');
    }

    if (missing.length) {
      alert('Please fill in the following required fields:\n- ' + missing.join('\n- '));
      return;
    }

    try{
      const res = await fetch('http://localhost:3000/signup',{
        method:'POST',
        mode: 'cors',
        headers:{
          'Content-Type':'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      if(!res.ok){
        alert(data.error || 'Signup failed');
        return;
      }
      // Redirect to the Sign In page
      window.location.href = 'signin.html';

    }catch(err){
      console.error(err);
      alert('Network error contacting backend. Is the server running?');
    }
  }

  const buyerSubmit = buyerForm.querySelector('button[type="submit"]');
  if(buyerSubmit){
    buyerSubmit.addEventListener('click', function(e){
      e.preventDefault();
      submitSignup('buyer');
    });
  }
  const sellerSubmit = sellerForm.querySelector('button[type="submit"]');
  if(sellerSubmit){
    sellerSubmit.addEventListener('click', function(e){
      e.preventDefault();
      submitSignup('seller');
    });
  }
})();
</script>
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sign Up — NSM Autos</title>
  <style>
    :root {
      --bg: #f6f7fb;
      --text: #0f172a;
      --muted: #64748b;
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --card-bg: #ffffff;
      --card-border: #e5e7eb;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; background: var(--bg); color: var(--text); font-family: Inter, Segoe UI, Roboto, Helvetica, Arial, system-ui, -apple-system, sans-serif; }
    .container { max-width: 900px; margin: 32px auto; padding: 0 16px; }
    .card { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 12px; box-shadow: 0 6px 16px rgba(0,0,0,0.06); }
    .card-header { padding: 16px 20px; border-bottom: 1px solid var(--card-border); display: flex; align-items: center; justify-content: space-between; }
    .card-title { margin: 0; font-size: 18px; }
    .card-body { padding: 20px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .grid-1 { display: grid; grid-template-columns: 1fr; gap: 12px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
    .field { display: flex; flex-direction: column; }
    .label { font-size: 12px; color: var(--muted); margin-bottom: 6px; }
    .input, .textarea, .select { padding: 10px 12px; border: 1px solid var(--card-border); border-radius: 8px; font-size: 14px; background: #fff; }
    .textarea { min-height: 100px; resize: vertical; }
    .actions { display: flex; gap: 8px; margin-top: 16px; }
    .btn { padding: 10px 14px; border-radius: 8px; border: 1px solid var(--card-border); background: #eef2ff; color: #1e293b; cursor: pointer; }
    .btn-primary { background: var(--primary); color: #fff; border-color: var(--primary); }
    .btn-primary:hover { background: var(--primary-hover); }
    .muted { color: var(--muted); }
    .role-toggle { display: flex; gap: 16px; margin: 8px 0 16px; }
    .help { font-size: 12px; color: var(--muted); }
    .hidden { display: none; }
    .notice { margin-top: 12px; padding: 10px 12px; border-radius: 8px; }
    .notice.error { background: #fee2e2; border: 1px solid #fecaca; color: #7f1d1d; }
    .notice.success { background: #ecfdf5; border: 1px solid #d1fae5; color: #064e3b; }
  </style>
</head>
<body>
  <div class="container" style="display:none">
    <div class="card" role="form">
      <div class="card-header">
        <h1 class="card-title">Create Your Account</h1>
        <a href="signin.html" class="btn" title="Go to Sign In">Already have an account?</a>
      </div>
      <div class="card-body">
        <form id="signup-form" novalidate>
          <div class="field">
            <div class="label">Account Type</div>
            <div class="role-toggle" role="radiogroup" aria-label="Choose account type">
              <label><input type="radio" name="role" id="role-buyer" value="buyer" checked /> Buyer</label>
              <label><input type="radio" name="role" id="role-seller" value="seller" /> Seller</label>
            </div>
          </div>

          <!-- Common fields -->
          <h3 class="muted" style="margin: 12px 0">Basic Information</h3>
          <div class="grid">
            <div class="field">
              <label class="label" for="name">Full Name / Company Name</label>
              <input class="input" id="name" name="name" type="text" placeholder="e.g., Jane Doe or NSM Autos" required />
            </div>
            <div class="field">
              <label class="label" for="email">Email</label>
              <input class="input" id="email" name="email" type="email" placeholder="you@example.com" required />
            </div>
          </div>
          <div class="grid">
            <div class="field">
              <label class="label" for="password">Password</label>
              <input class="input" id="password" name="password" type="password" placeholder="••••••••" required />
            </div>
            <div class="field">
              <label class="label" for="phone_number">Phone Number</label>
              <input class="input" id="phone_number" name="phone_number" type="tel" placeholder="e.g., +1 555-123-4567" required />
            </div>
          </div>
          <div class="grid">
            <div class="field">
              <label class="label" for="country">Country</label>
              <input class="input" id="country" name="country" type="text" placeholder="e.g., United States" required />
            </div>
            <div class="field">
              <label class="label" for="company_logo_url">Company Logo URL</label>
              <input class="input" id="company_logo_url" name="company_logo_url" type="url" placeholder="https://..." required />
              <button type="button" class="btn" id="upload-company-logo-btn" style="margin-top:8px">Upload Logo File</button>
              <input type="file" id="company_logo_file_uploader" class="hidden" accept="image/*" />
            </div>
          </div>

          <!-- Seller-only fields -->
          <div id="seller-section" class="hidden" aria-hidden="true">
            <h3 class="muted" style="margin: 16px 0 8px">Seller Company Details</h3>
            <div class="grid">
              <div class="field">
                <label class="label" for="company_name_english">Company Name (English)</label>
                <input class="input" id="company_name_english" name="company_name_english" type="text" placeholder="NSM Autos" required />
              </div>
              <div class="field">
                <label class="label" for="company_name_korean">Company Name (Korean)</label>
                <input class="input" id="company_name_korean" name="company_name_korean" type="text" placeholder="회사 이름" required />
              </div>
            </div>
            <div class="grid">
              <div class="field">
                <label class="label" for="representative_name">Representative Name</label>
                <input class="input" id="representative_name" name="representative_name" type="text" placeholder="John Smith" required />
              </div>
              <div class="field">
                <label class="label" for="company_tel">Company Tel</label>
                <input class="input" id="company_tel" name="company_tel" type="text" placeholder="e.g., +82 2-1234-5678" required />
              </div>
            </div>
            <div class="grid">
              <div class="field">
                <label class="label" for="company_address">Company Address</label>
                <input class="input" id="company_address" name="company_address" type="text" placeholder="Street address" required />
              </div>
              <div class="field">
                <label class="label" for="detailed_address">Detailed Address</label>
                <input class="input" id="detailed_address" name="detailed_address" type="text" placeholder="Suite, floor, etc." required />
              </div>
            </div>
            <div class="grid">
              <div class="field">
                <label class="label" for="establishment_date">Establishment Date</label>
                <input class="input" id="establishment_date" name="establishment_date" type="date" required />
              </div>
              <div class="field">
                <label class="label" for="business_registration_url">Business Registration URL</label>
                <input class="input" id="business_registration_url" name="business_registration_url" type="url" placeholder="https://..." required />
                <button type="button" class="btn" id="upload-business-reg-btn" style="margin-top:8px">Upload Registration File</button>
                <input type="file" id="business_reg_file_uploader" class="hidden" accept="application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,image/*" />
              </div>
            </div>
            <div class="grid">
              <div class="field">
                <label class="label" for="business_registration_document">Business Registration Document (link or filename)</label>
                <input class="input" id="business_registration_document" name="business_registration_document" type="text" placeholder="document.pdf or https://..." required />
              </div>
              <div class="field">
                <label class="label" for="export_items">Export Items</label>
                <input class="input" id="export_items" name="export_items" type="text" placeholder="e.g., Cars, Parts" required />
              </div>
            </div>
            <div class="grid">
              <div class="field">
                <label class="label" for="available_languages">Available Languages (comma-separated)</label>
                <input class="input" id="available_languages" name="available_languages" type="text" placeholder="English, Korean" required />
              </div>
              <div class="field">
                <label class="label" for="company_introduction">Company Introduction</label>
                <textarea class="textarea" id="company_introduction" name="company_introduction" placeholder="Tell buyers about your company" required></textarea>
              </div>
            </div>
            <h3 class="muted" style="margin: 16px 0 8px">Bank Details</h3>
            <div class="grid">
              <div class="field">
                <label class="label" for="bank_name">Bank Name</label>
                <input class="input" id="bank_name" name="bank_name" type="text" placeholder="e.g., KEB Hana" required />
              </div>
              <div class="field">
                <label class="label" for="account_holder_name">Account Holder Name</label>
                <input class="input" id="account_holder_name" name="account_holder_name" type="text" placeholder="e.g., NSM AUTOS Co." required />
              </div>
            </div>
            <div class="grid">
              <div class="field">
                <label class="label" for="account_number">Account Number</label>
                <input class="input" id="account_number" name="account_number" type="text" placeholder="1234-5678-9012" required />
              </div>
              <div class="field">
                <span class="help">Seller accounts are reviewed by admins. Status is set to Pending until approved.</span>
              </div>
            </div>
          </div>

          <div class="actions">
            <button id="signup-submit" type="submit" class="btn btn-primary">Sign Up</button>
            <button type="button" class="btn" onclick="location.href='signin.html'">Cancel</button>
          </div>
          <div id="message" class="notice hidden" role="alert"></div>
        </form>
      </div>
    </div>
  </div>

  <script>
    (function(){
      var form = document.getElementById('signup-form');
      var btn = document.getElementById('signup-submit');
      var message = document.getElementById('message');
      var sellerSection = document.getElementById('seller-section');
      var roleBuyer = document.getElementById('role-buyer');
      var roleSeller = document.getElementById('role-seller');

      function setMessage(type, text) {
        message.className = 'notice ' + (type === 'error' ? 'error' : 'success');
        message.textContent = text;
        message.classList.remove('hidden');
      }

      function clearMessage() {
        message.className = 'notice hidden';
        message.textContent = '';
      }

      function updateRoleUI() {
        var isSeller = roleSeller.checked;
        sellerSection.classList.toggle('hidden', !isSeller);
        sellerSection.setAttribute('aria-hidden', String(!isSeller));
        // Disable seller-only inputs when buyer is selected to avoid required validation firing
        var sellerInputs = sellerSection.querySelectorAll('input, textarea, select, button');
        sellerInputs.forEach(function(el){
          if (el.id && el.id !== 'signup-submit') {
            el.disabled = !isSeller;
          }
        });
      }
      roleBuyer.addEventListener('change', updateRoleUI);
      roleSeller.addEventListener('change', updateRoleUI);
      updateRoleUI();

      // Helpers for client-side uploads (bottom form)
      async function fileToDataUrl(file){
        return new Promise(function(resolve, reject){
          try {
            var reader = new FileReader();
            reader.onload = function(){ resolve(reader.result); };
            reader.onerror = function(e){ reject(e); };
            reader.readAsDataURL(file);
          } catch (e) { reject(e); }
        });
      }
      async function uploadFileToServer(file){
        var dataUrl = await fileToDataUrl(file);
        var resp = await fetch('http://localhost:3000/upload', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
          body: JSON.stringify({ filename: file.name, dataUrl: dataUrl })
        });
        var out = null;
        try { out = await resp.json(); } catch(_) {}
        if (!resp.ok || !out || !out.url) {
          var errMsg = (out && out.error) ? out.error : ('Upload failed (HTTP '+resp.status+')');
          throw new Error(errMsg);
        }
        return out.url; // e.g. "/uploads/xyz.png"
      }

      // UI: Upload buttons for bottom form
      var logoBtn = document.getElementById('upload-company-logo-btn');
      var logoPicker = document.getElementById('company_logo_file_uploader');
      if (logoBtn && logoPicker) {
        logoBtn.addEventListener('click', function(){ logoPicker.click(); });
        logoPicker.addEventListener('change', async function(){
          const file = (logoPicker.files && logoPicker.files[0]) || null;
          if (!file) return;
          btn.disabled = true; var oldText = btn.textContent; btn.textContent = 'Uploading logo...';
          try {
            var pathUrl = await uploadFileToServer(file);
            var absolute = 'http://localhost:3000' + pathUrl;
            document.getElementById('company_logo_url').value = absolute;
            setMessage('success', 'Logo uploaded.');
          } catch (err) {
            console.error('Logo upload error:', err);
            setMessage('error', 'Logo upload failed: ' + err.message);
          }
          btn.disabled = false; btn.textContent = oldText; logoPicker.value = '';
        });
      }

      var regBtn = document.getElementById('upload-business-reg-btn');
      var regPicker = document.getElementById('business_reg_file_uploader');
      if (regBtn && regPicker) {
        regBtn.addEventListener('click', function(){ regPicker.click(); });
        regPicker.addEventListener('change', async function(){
          const file = (regPicker.files && regPicker.files[0]) || null;
          if (!file) return;
          btn.disabled = true; var oldText2 = btn.textContent; btn.textContent = 'Uploading registration...';
          try {
            var pathUrl2 = await uploadFileToServer(file);
            var absolute2 = 'http://localhost:3000' + pathUrl2;
            // Fill both URL and document fields so required validity passes
            document.getElementById('business_registration_url').value = absolute2;
            var docEl = document.getElementById('business_registration_document');
            if (docEl) docEl.value = absolute2;
            setMessage('success', 'Business registration uploaded.');
          } catch (err) {
            console.error('Registration upload error:', err);
            setMessage('error', 'Registration upload failed: ' + err.message);
          }
          btn.disabled = false; btn.textContent = oldText2; regPicker.value = '';
        });
      }

      async function handleSubmit(event) {
        event.preventDefault();
        clearMessage();
        btn.disabled = true; btn.textContent = 'Submitting...';
        try {
          // Run built-in validity checks to enforce required fields
          if (!form.reportValidity()) {
            setMessage('error', 'Please fill in all required fields.');
            btn.disabled = false; btn.textContent = 'Sign Up';
            return;
          }
          var role = roleSeller.checked ? 'seller' : 'buyer';
          var payload = {
            role: role,
            name: document.getElementById('name').value.trim(),
            email: document.getElementById('email').value.trim(),
            password: document.getElementById('password').value,
            phone_number: document.getElementById('phone_number').value.trim() || null,
            country: document.getElementById('country').value.trim() || null,
            company_logo_url: document.getElementById('company_logo_url').value.trim() || null
          };

          if (role === 'seller') {
            payload.company_name_english = document.getElementById('company_name_english').value.trim() || null;
            payload.company_name_korean = document.getElementById('company_name_korean').value.trim() || null;
            payload.representative_name = document.getElementById('representative_name').value.trim() || null;
            payload.company_tel = document.getElementById('company_tel').value.trim() || null;
            payload.company_address = document.getElementById('company_address').value.trim() || null;
            payload.detailed_address = document.getElementById('detailed_address').value.trim() || null;
            payload.establishment_date = document.getElementById('establishment_date').value || null;
            payload.business_registration_url = document.getElementById('business_registration_url').value.trim() || null;
            payload.business_registration_document = document.getElementById('business_registration_document').value.trim() || null;
            payload.export_items = document.getElementById('export_items').value.trim() || null;
            var langsRaw = document.getElementById('available_languages').value.trim();
            payload.available_languages = langsRaw ? langsRaw : null; // store as TEXT (comma-separated)
            payload.company_introduction = document.getElementById('company_introduction').value.trim() || null;
            payload.bank_name = document.getElementById('bank_name').value.trim() || null;
            payload.account_holder_name = document.getElementById('account_holder_name').value.trim() || null;
            payload.account_number = document.getElementById('account_number').value.trim() || null;
          }

          if (!payload.name || !payload.email || !payload.password) {
            setMessage('error', 'Please fill in Name, Email, and Password.');
            btn.disabled = false; btn.textContent = 'Sign Up';
            return;
          }

          var res = await fetch('http://localhost:3000/signup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
            body: JSON.stringify(payload)
          });
          var data = null;
          try { data = await res.json(); } catch (e) {}
          if (!res.ok) {
            var msg = (data && data.error) ? data.error : ('Signup failed (HTTP ' + res.status + ')');
            setMessage('error', msg);
            btn.disabled = false; btn.textContent = 'Sign Up';
            return;
          }

          setMessage('success', 'Signup successful! Redirecting to Sign In...');
          setTimeout(function(){ window.location.href = 'signin.html'; }, 600);
        } catch (err) {
          console.error('Signup error:', err);
          setMessage('error', 'Network error. Is the backend running on http://localhost:3000?');
          btn.disabled = false; btn.textContent = 'Sign Up';
        }
      }

      // Listen for form submission and submit button click
      form.addEventListener('submit', handleSubmit);
      btn.addEventListener('click', function(ev){ ev.preventDefault(); handleSubmit(ev); });
    })();
  </script>
</body>
</html>